<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monsoon Mariner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Mobile polish */
        body { -webkit-user-select: none; user-select: none; touch-action: manipulation; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #1c1917; }
        ::-webkit-scrollbar-thumb { background: #44403c; border-radius: 2px; }
        .tap-highlight-transparent { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-stone-950 h-[100dvh] flex justify-center overflow-hidden font-sans text-stone-800">

    <div id="game-app" class="w-full max-w-md bg-stone-100 shadow-2xl h-full flex flex-col relative">
        </div>

    <script>
        // --- 1. CONFIGURATION ---
        
        // YOUR COORDINATES APPLIED HERE
        const PORTS = [
            { id: 'kilwa', name: 'Kilwa', region: 'Africa', x: 15, y: 77, color: '#f59e0b', img: 'https://images.unsplash.com/photo-1523726491678-bf852e717f6a?auto=format&fit=crop&q=80&w=800' },
            { id: 'aden', name: 'Aden', region: 'Arabia', x: 18, y: 46, color: '#ef4444', img: 'https://images.unsplash.com/photo-1548013146-72479768bada?auto=format&fit=crop&q=80&w=800' },
            { id: 'calicut', name: 'Calicut', region: 'India', x: 47, y: 50, color: '#8b5cf6', img: 'https://images.unsplash.com/photo-1596401057633-565652b5e260?auto=format&fit=crop&q=80&w=800' },
            { id: 'malacca', name: 'Malacca', region: 'SE Asia', x: 71, y: 60, color: '#10b981', img: 'https://images.unsplash.com/photo-1534234828569-1f3553dadd3d?auto=format&fit=crop&q=80&w=800' },
            { id: 'hangzhou', name: 'Hangzhou', region: 'China', x: 88, y: 22, color: '#3b82f6', img: 'https://images.unsplash.com/photo-1537249011568-1eb6e6c8914b?auto=format&fit=crop&q=80&w=800' },
        ];

        const GOODS = {
            iron: { name: 'Iron', basePrice: 10, icon: 'â›ï¸' },
            ivory: { name: 'Ivory', basePrice: 50, icon: 'ðŸ˜' },
            spices: { name: 'Spices', basePrice: 40, icon: 'ðŸŒ¶ï¸' },
            silk: { name: 'Silk', basePrice: 80, icon: 'ðŸ‘˜' },
            porcelain: { name: 'Porcelain', basePrice: 100, icon: 'ðŸº' },
        };

        // Economic Multipliers (High number = Expensive/Sell High, Low = Cheap/Buy Low)
        const ECONOMY = {
            kilwa: { iron: 1.2, ivory: 0.3, spices: 1.5, silk: 2.0, porcelain: 2.5 },
            aden: { iron: 0.8, ivory: 1.2, spices: 1.0, silk: 1.5, porcelain: 2.0 },
            calicut: { iron: 1.0, ivory: 1.5, spices: 0.2, silk: 1.2, porcelain: 1.5 },
            malacca: { iron: 1.2, ivory: 1.8, spices: 0.4, silk: 0.8, porcelain: 1.2 },
            hangzhou: { iron: 1.0, ivory: 2.5, spices: 2.0, silk: 0.3, porcelain: 0.2 },
        };

        const MONTHS = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        const MAX_INVENTORY = 20;

        // --- 2. STATE ---
        let state = {
            view: 'map', 
            currentPortId: 'kilwa', // Start in Kilwa
            month: 0, // Jan
            year: 1300,
            money: 100,
            inventory: {},
            log: [{ text: "Welcome to the Indian Ocean.", type: "neutral" }]
        };

        // --- 3. GAME LOGIC ---
        
        // Summer (Apr-Sep) = EAST WIND
        // Winter (Oct-Mar) = WEST WIND
        function getWindDirection() {
            return (state.month >= 3 && state.month <= 8) ? 'east' : 'west';
        }

        function getCurrentPort() {
            return PORTS.find(p => p.id === state.currentPortId);
        }

        function getPrices() {
            const port = state.currentPortId;
            let prices = {};
            
            Object.keys(GOODS).forEach(key => {
                const base = GOODS[key].basePrice;
                const localMult = ECONOMY[port][key];
                // Simple static pricing for stability
                prices[key] = {
                    buy: Math.floor(base * localMult),
                    sell: Math.floor(base * localMult * 0.9) // 10% spread
                };
            });
            return prices;
        }

        function advanceTime(months) {
            let newMonth = state.month + months;
            let yearAdd = 0;
            while (newMonth > 11) { newMonth -= 12; yearAdd++; }
            state.month = newMonth;
            state.year += yearAdd;
            render();
        }

        function actionTravel(e, targetId) {
            e.stopPropagation(); 

            if(targetId === state.currentPortId) {
                state.view = 'market';
                render();
                return;
            }

            const currentPort = getCurrentPort();
            const targetPort = PORTS.find(p => p.id === targetId);
            const wind = getWindDirection();

            // Determine travel direction based on X coordinate
            // X increases as you go East
            const travelDir = targetPort.x > currentPort.x ? 'east' : 'west';

            if(travelDir !== wind) {
                // FAIL: MOVING AGAINST WIND
                state.log.unshift({text: `Cannot sail ${travelDir.toUpperCase()} against the ${wind.toUpperCase()} wind!`, type: 'bad'});
                render();
                return;
            }

            // SUCCESS
            const dist = Math.abs(targetPort.x - currentPort.x);
            const timeTaken = dist > 40 ? 2 : 1; // Far ports take 2 months

            state.currentPortId = targetId;
            state.view = 'market';
            state.log.unshift({text: `Arrived at ${targetPort.name} (${timeTaken} mo).`, type: 'good'});
            advanceTime(timeTaken);
        }

        function actionTrade(item, isBuy) {
            const prices = getPrices();
            const price = isBuy ? prices[item].buy : prices[item].sell;
            const totalItems = Object.values(state.inventory).reduce((a,b)=>a+b,0);
            const owned = state.inventory[item] || 0;

            if(isBuy) {
                if(state.money >= price && totalItems < MAX_INVENTORY) {
                    state.money -= price;
                    state.inventory[item] = owned + 1;
                    state.log.unshift({text: `Bought ${GOODS[item].name} for ${price}g`, type: 'neutral'});
                } else if (totalItems >= MAX_INVENTORY) {
                    state.log.unshift({text: `Cargo full!`, type: 'bad'});
                }
            } else {
                if(owned > 0) {
                    state.money += price;
                    state.inventory[item] = owned - 1;
                    state.log.unshift({text: `Sold ${GOODS[item].name} for ${price}g`, type: 'good'});
                }
            }
            render();
        }

        function waitMonth() {
            state.log.unshift({text: `Waited for winds to change.`, type: 'neutral'});
            advanceTime(1);
        }

        // --- 4. RENDERERS ---

        function renderHeader() {
            const wind = getWindDirection();
            return `
            <div class="bg-stone-900 text-stone-100 p-3 flex justify-between items-center h-16 shrink-0 z-30 shadow-md">
                <div class="flex items-center gap-4">
                    <div class="leading-tight">
                        <div class="text-[10px] text-stone-400">DATE</div>
                        <div class="font-bold text-sm">${MONTHS[state.month]} ${state.year}</div>
                    </div>
                    <div class="leading-tight">
                        <div class="text-[10px] text-stone-400">WIND</div>
                        <div class="font-bold text-xs flex items-center gap-1 ${wind==='east'?'text-emerald-400':'text-orange-400'}">
                            ${wind==='east' ? 'EAST <i data-lucide="arrow-right" width="12"></i>' : '<i data-lucide="arrow-left" width="12"></i> WEST'}
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-[10px] text-stone-400">GOLD</div>
                    <div class="font-mono text-yellow-400 font-bold text-lg">${state.money}</div>
                </div>
            </div>`;
        }

        function renderMap() {
            const wind = getWindDirection();
            const currentPort = getCurrentPort();

            let html = `<div class="w-full h-full relative bg-[#0f172a] overflow-hidden tap-highlight-transparent">
                
                <img src="./IMG_4324.png" class="absolute inset-0 w-full h-full object-cover opacity-60 z-0">
                
                <div class="absolute top-4 left-0 w-full flex justify-center pointer-events-none z-10 opacity-30">
                     <div class="text-6xl font-black tracking-widest ${wind==='east'?'text-emerald-500':'text-orange-500'}">
                        ${wind === 'east' ? '>>>' : '<<<'}
                     </div>
                </div>
            `;

            PORTS.forEach((port) => {
                const isCurrent = state.currentPortId === port.id;
                
                // Logic: Can we sail here?
                // East wind allows going to X > currentX
                // West wind allows going to X < currentX
                const dirToPort = port.x > currentPort.x ? 'east' : (port.x < currentPort.x ? 'west' : 'same');
                const reachable = isCurrent || dirToPort === wind;
                
                // Visual Styling
                const opacity = reachable ? 'opacity-100' : 'opacity-40 grayscale';
                const scale = isCurrent ? 'scale-110 z-30' : 'scale-100 z-20';
                const border = isCurrent ? 'border-white ring-2 ring-blue-500' : (reachable ? 'border-green-400' : 'border-stone-600');

                html += `
                <div onclick="actionTravel(event, '${port.id}')" 
                     class="absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center transition-all duration-300 cursor-pointer ${scale} ${opacity}"
                     style="left: ${port.x}%; top: ${port.y}%;">
                    
                    ${reachable && !isCurrent ? '<div class="absolute -inset-2 rounded-full border border-green-400 animate-ping opacity-50 pointer-events-none"></div>' : ''}
                    
                    <div class="w-4 h-4 rounded-full border-2 bg-stone-800 shadow-xl ${border}"></div>
                    
                    <div class="mt-1 bg-black/70 px-2 py-0.5 rounded text-[10px] font-bold text-white whitespace-nowrap backdrop-blur-sm border border-white/10 shadow-lg">
                        ${port.name}
                    </div>
                </div>`;
            });

            html += `
                <button onclick="waitMonth()" class="absolute bottom-6 right-6 z-40 bg-stone-800 text-white px-4 py-3 rounded-full shadow-xl border border-stone-600 font-bold text-xs flex items-center gap-2 active:scale-95">
                    <i data-lucide="hourglass" width="16"></i> Wait 1 Mo
                </button>
            </div>`;
            return html;
        }

        function renderMarket() {
            const port = getCurrentPort();
            const prices = getPrices();
            const totalItems = Object.values(state.inventory).reduce((a,b)=>a+b,0);
            
            let html = `
            <div class="flex-1 bg-stone-100 flex flex-col relative overflow-hidden h-full">
                <div class="h-[30%] w-full relative shrink-0 bg-stone-800">
                    <img src="${port.img}" class="w-full h-full object-cover opacity-80">
                    <div class="absolute inset-0 bg-gradient-to-t from-stone-900 via-transparent to-transparent"></div>
                    
                    <div class="absolute top-4 left-4 z-10">
                        <button onclick="state.view='map'; render()" class="bg-black/50 backdrop-blur border border-white/20 px-3 py-1.5 rounded-full flex items-center gap-1 text-white hover:bg-black/70 active:scale-95 transition-transform">
                            <i data-lucide="map" width="14"></i> <span class="text-xs font-bold">Back to Map</span>
                        </button>
                    </div>

                    <div class="absolute bottom-4 left-4 text-white z-10">
                        <h2 class="text-2xl font-bold leading-none shadow-black drop-shadow-md">${port.name}</h2>
                        <div class="text-xs text-stone-300 uppercase tracking-widest">${port.region}</div>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-4 bg-stone-100">
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">
                        <div class="bg-stone-50 px-4 py-2 border-b border-stone-200 flex justify-between items-center">
                            <span class="text-xs font-bold text-stone-500 uppercase tracking-wider">Marketplace</span>
                            <span class="text-[10px] text-stone-400 font-mono">CAPACITY: ${totalItems}/${MAX_INVENTORY}</span>
                        </div>
            `;

            Object.keys(GOODS).forEach((key) => {
                const good = GOODS[key];
                const p = prices[key];
                const owned = state.inventory[key] || 0;
                const canBuy = state.money >= p.buy && totalItems < MAX_INVENTORY;
                
                html += `
                <div class="p-3 flex items-center justify-between border-b border-stone-100 last:border-0">
                    <div class="flex items-center gap-3">
                        <div class="text-2xl w-8 text-center">${good.icon}</div>
                        <div>
                            <div class="font-bold text-stone-800 text-sm">${good.name}</div>
                            <div class="text-[10px] text-stone-400">Owned: ${owned}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="actionTrade('${key}', true)" ${!canBuy ? 'disabled' : ''} 
                            class="flex flex-col items-center justify-center w-14 py-1 rounded border transition-all active:scale-95 ${canBuy ? 'bg-emerald-50 border-emerald-200 text-emerald-700 shadow-sm' : 'bg-stone-50 border-stone-100 text-stone-300 opacity-50'}">
                            <span class="text-[9px] font-bold uppercase">Buy</span>
                            <span class="text-xs font-bold">${p.buy}</span>
                        </button>
                        <button onclick="actionTrade('${key}', false)" ${owned===0 ? 'disabled' : ''} 
                            class="flex flex-col items-center justify-center w-14 py-1 rounded border transition-all active:scale-95 ${owned>0 ? 'bg-amber-50 border-amber-200 text-amber-700 shadow-sm' : 'bg-stone-50 border-stone-100 text-stone-300 opacity-50'}">
                            <span class="text-[9px] font-bold uppercase">Sell</span>
                            <span class="text-xs font-bold">${p.sell}</span>
                        </button>
                    </div>
                </div>`;
            });

            html += `</div>
                    <button onclick="waitMonth()" class="mt-4 w-full py-3 bg-stone-200 text-stone-600 font-bold rounded-lg text-xs flex items-center justify-center gap-2 active:bg-stone-300">
                        <i data-lucide="hourglass" width="14"></i> Wait here 1 Month
                    </button>
            </div></div>`;
            return html;
        }

        function renderLog() {
            const container = document.getElementById('log-container');
            if(!container) return;
            container.innerHTML = state.log.map(l => `
                <div class="p-2 border-b border-stone-100 text-[11px] font-mono leading-tight ${l.type === 'good' ? 'text-emerald-700 bg-emerald-50/50' : l.type === 'bad' ? 'text-red-700 bg-red-50/50' : 'text-stone-600'}">
                    ${l.text}
                </div>
            `).join('');
        }

        function render() {
            const app = document.getElementById('game-app');
            let content = renderHeader();
            
            content += `<div class="flex-1 overflow-hidden relative flex flex-col">
                ${state.view === 'map' ? renderMap() : renderMarket()}
            </div>`;
            
            content += `<div class="h-24 bg-white border-t border-stone-200 overflow-y-auto shrink-0" id="log-container"></div>`;

            app.innerHTML = content;
            renderLog();
            lucide.createIcons();
        }

        // Start
        render();

    </script>
</body>
</html>
